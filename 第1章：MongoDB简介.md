# 第1章：简介(Introduction)

## 1.1 MongoDB简介

MongoDB是一个强大、灵活、可扩展的通用数据库。

#### 易用性

MongoDB是一种面向文档的数据库，而不是关系型数据库。由于脱离了关系模型会使得数据库扩展变得更加容易，当然MongoDB还有非常多其他的优点。

面向文档的数据库使用更加灵活的“文档”取代关系型数据库中“行”。文档中允许嵌入其他文档和数组，这使得文档可以表达复杂层次的数据关系，也符合现代面向对象语言开发人员的思考使用数据方式。

由于不需要提前预定义数据库架构，可以灵活自由地添加删除字段，因此开发人员可以快速迭代，最终选择最合适的模型。



#### 扩展性

> 注意，这里说的扩展性不是指数据库字段的扩展，而是指数据库服务器的扩展

随着项目数据库的数据量不断扩大，都需要扩展服务器数量来提高访问性能。

MongoDB很容易进行横向扩展，MongoDB会自动处理数据平衡和集群数据管理，自动分发文档，将读写路由指向正确的服务器上。

|                         | :left_right_arrow: | 应用驱动程序(Application Drive) ... |
| ----------------------- | ------------------ | ----------------------------------- |
| **mongos(路由 router)** | :left_right_arrow: | **数据库服务器(Config server)...**  |
|                         | :left_right_arrow: | **分片数据(Shard Data) ...**        |



#### 丰富性

除了常见的增删改查，MongoDB还提供其他丰富的功能：

* **索引**：MongoDB支持二级索引，提供独特、复合、地理空间和全文检索功能。还支持层次结构(嵌套文档和数组)上的二级索引。

  > 二级索引是指根据数据中的某个字段再次进行排序，你可以把数据库想象成一本新华词典，该词典收录了几十万个汉字，为了方便快速找到某个汉字，词典中对同一个汉字又创建了 2个 不同维度的索引：按拼音首字母查询、按部首查询
  > 对于MongoDB数据库来说，除了使用 _id 来依次储存数据之外(即默认排序方式)，还可以按照文档某个字段来作为二级索引，方便快速从集合中查找数据。至于二级索引究竟使用哪个字段(例如是按照拼音首字母排序，还是按照部首排序)，这个要根据实际项目需求来确定。

* **聚合**：MongoDB提供基于数据处理管道概念的聚合查询，通过一系列相对简单、阶段性的数据操作来构建复杂的数据操作。

  > 就是把一个复杂的数据操作，拆分成若干个简单的数据操作

* **特殊集合和索引类型**：MongoDB支持将在某个时间过期的数据的生存时间集合，和部分索引(仅限于符合匹配条件的文档)。

* **文件存储**：MongoDB支持一个 易于使用的协议来储存数据文件。

  > 例如 MongoDB 支持 Javascript 的语法来储存操作数据



#### 高性能

高性能是MongoDB的一个产品设计驱动目标。

> 具体怎么实现了高性能，暂时就不用深究，只需要知道 MongoDB 处理数据性能很高即可。



## 1.2 开始探索

MongoDB 使用简单却强大的 MongoShell 命令来执行各种操作管理。同时 MongoShell 也可以执行 JavaScript 命令，允许用户创建和执行自定义脚本。

MongoDB属于文档型数据库，主要由以下几部分组成：

1. 文档(Document)
2. 集合(Collections)
3. 数据库(Databases)



#### 文档(Document)

文档是 MongoDB 最基础的组成单位，文档是一组有序的键(key)和值(value)。
例如：{ "greeting" : "Hello, world!" }

> 键(key)：键名
> 值(value)：键值
> 说直白点，MongoDB 的文档是 JSON 的形式

键(key)可以是任意的 UTF-8 字符串，但有几个点除外：

1. 一个文档中键 (key)不能出现2次
2. 键(key)不能包含 \0 (thu null character)
3. 不能包含 . 或 $ 符号

> 不要包含除下划线(_)以外的其他特殊符号、不建议以数字开头

**MongoDB的键(key)名区分大小写**，例如：{“count”:5} 和 {"Count":5} 是不一样的

同时，**MongoDB的键值(value)区分是否加引号**，例如：{'"count":5} 和 {"count":"5"} 是不一样的



#### 集合(Collections)

一组或很多个文档构成一个集合。集合拥有以下特性：

**动态架构、动态模式**

同一个集合中的不同文档，可以拥有完全不相同的数据结构。例如同一个集合中的 2 个文档，完全可以使用不同的键名：

{  "greeting" : "Hello, World!" } {  "slogin" : "挺住 TikTok !" }

不光是键(key)名可以不一样，键值类型、键的数量都可以完全不一样。

> MongoDB是非关系数据库中，最像关系数据的数据库

**集合命名规则**

集合名可以是任意的 UTF-8 字符串，但有几点除外：

1. 不允许使用空字符串(空格字符串)，例如 “”、"    " 都不被允许使用
2. 不能包含 \0 (thu null character)
3. 不能以 system. 作为集合名的开头，因为 system. 是 MongoDB 为集合操作保留的关键词，例如 system.users 为数据库用户相关信息、system.namespaces 为所有集合相关信息。
4. 不能包含 $ 符号

> 不要包含除下划线(_)以外的其他特殊符号、不建议以数字开头



#### 数据库(Databases)

0个或多个集合构成一个数据库。通常建议将一个项目的所有数据集合都存放在同一个数据库中。

**数据库命名规则**

数据库名可以是任意的 UTF-8 字符串，但有几点需要注意：

1. 不允许使用空字符串(空格字符串)，例如 “”、"    " 都不被允许使用
2. 不允许使用 /、\\、.、"、*、<、>、:、|、?、$ 或  \0 (thu null character)
3. 数据库名不区分大小写
4. 数据库名最大限制为64字节
5. MongoDB 默认自带的数据库，例如：admin、local、config、test 等



#### 开始运行 MongoDB 数据库

若当前系统已安装 MongoDB 数据库，在 Unix 系统(Linux系统或macOS系统) 下最简单启动 MongoDB 的命令是在终端执行：

```
mongod
```

如果是 Windows 系统，则执行：

```
mongod.exe
```

> 事实上应该是找到 mongod.exe 所在目录，在终端 cd 到该目录后，执行：./mongod

执行该命令过后，会尝试使用默认参数值启动 mongod 数据库服务。若修改过 mongod 启动配置，则在缺省启动参数下有可能会启动失败。如果系统端口 27017 被占用(通常情况是已经启动过 mongod 服务了)、或 ../data/db 目录无写入权限，则会启动失败。

> 默认缺省启动参数下，会尝试使用以下配置启动 mongod：
>
> 1. 默认采用无用户名和密码的登录方式
> 2. 端口默认使用 27017
> 3. 数据库目录默认使用 ../data/db/

如果想停止 mongod 服务，则在终端执行：ctrl + c 即可停止并退出 mongod 服务。



#### MongoDB Shell 命令入门

可以通过 MongoDB Shell 命令来操作管理 MongoDB 数据库。

> 特别强调一下：mongod 是用来启动 MongDB 数据库的、而 mongo shell 是用来管理 MongDB 数据库的。

**执行 Mongo Shell 命令：**

```
mongo
```

执行上述命令，会打印出当前  mongo 的版本信息，并尝试用默认的参数设置去连接 mongod 数据库。

> 注意：如非特殊说明，以后所有的执行命令环境，均指 Unix 系统(Linux系统或 macOS系统) 的终端。
> 事实上在 windows 系统中的绝大多数命令和 Unix 系统运行的命令是完全相同的。

若连接成功，则会进入到 mongo 终端的交过界面，在这个界面中，除了可以执行 MongoDB 管理命令的，mongo 也完全支持 JavaScript  语法。例如当启动 mongo 成功后，在 mongo 交互终端可以执行以下代码：

```
let x = 200;  # 会打印出：200
x/5;  # 会打印出 40
```

甚至可以直接使用 JavaScript 中的函数：

```
Math.sin(Math.PI/2)
new Date("2020/08/07")
```

当然也可以声明和调用自己编写的 JS 函数：

```
function myfun(param){
...
}
myfun(xxx)
```

**拆分换行输入命令**

MongoDB Shell 每次只能执行一行命令，若在命令输入一部分后摁 回车键(Enter)，mongo shell 会智能判断当前语句是否已输入完整，若不完整则可以在下一行中继续输入命令。

若连续摁 3 次 回车键，则会取消并丢弃当前所有已输入却还未执行的代码命令，结束并跳出当前命令换行输入状态。



#### MongoDB 客户端

当成功启动一个 mongo 客户端后，事实上这也是一个 MongoDB 的客户端，可以连接操作 mongod 所创建的数据库。

```
db
```

执行上述命令，会打印出当前正在连接的数据库名字。test 是默认 MongoDB 连接到的数据库。

切换当前所连接的数据库，命令为：use <database-name\>，例如：

```
use video
```

执行上述命令，会将当前连接的数据库切换到 video。

> 请注意，在实际项目开发中，一定会配置启动项，并使用有限制访问权限的用户认证登录，且一个项目只有一个数据库

当切换到新的数据库后，可通过 db.<collcetion\-name> 切换到当前数据库中的某集合，例如：

```
db.movies
```

执行上述命令，会将当前操作切换到 movies 集合中。

> 请注意，无论当前数据库是哪一个，都必须使用 db 来代替该数据，例如 db.movies 是合法有效的，但是不可以使用 video.movies 来尝试切换到对应集合中。

> 如果关闭、退出当前 MongoDB 客户端，只是相当于断开了与 mongod 数据库的连接，mongod 数据库依然会继续运行。



#### 基础的 mongo shell 命令

数据库常见的操作：增删改查。

**增加数据**

增加数据有非常多种函数，这里以 insertOne 函数为例，演示如何增加一条电影数据。

> 可能我们更习惯使用 “添加一条数据” 这个说法，但是在 MongoDB 中更加官方的说法为 “添加一个文档”，因为在 MongoDB 中，文档 就指 数据、数据就是以文档的形式作为最小单位存在着。
> “如何增加一条电影数据”更加官方的说法为：“如何添加一条电影对应的文档”，出于个人习惯，我更倾向于使用“添加一条电影数据”这种形式，所以在以后的文档中，你应该知道“添加数据”和“添加文档”是同一个意思。

首先我们假设要添加的一条电影数据对应的文档如下：

```
{"title":"我在人间混日子", "director": "puxiao", "year":2020}
```

那么，我们可以通过以下命令，将该条数据添加到 movies 集合中：

```
use video
db.movies.insertOne({"title":"我在人间混日子", "director": "puxiao", "year":2020})
```



